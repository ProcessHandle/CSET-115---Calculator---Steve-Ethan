<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            background: #1a1a1a;
            margin: 0;
            font-family: Arial, sans-serif;
            gap: 20px;
            padding: 20px;
            color: #e0e0e0;
        }

        #MainSect,
        #HistoryPane {
            background: rgba(43, 43, 43, 0.75);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.45);
        }

        #MainSect {
            max-width: 400px;
            width: 100%;
        }

        #SubDisplay {
            width: 100%;
            font-size: 16px;
            text-align: right;
            color: #9c9c9c;
            padding: 2px 10px;
            box-sizing: border-box;
            min-height: 20px;
            overflow: hidden;
        }

        #DisplaySect {
            width: 100%;
            height: 60px;
            font-size: 28px;
            text-align: right;
            padding: 10px;
            border: none;
            outline: none;
            background-color: transparent;
            color: #f5f5f5;
            border-bottom: 2px solid rgba(255, 255, 255, 0.08);
            box-sizing: border-box;
        }

        #ButtonSect {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            /*Rows of 4 per column */
            grid-auto-rows: 60px;
            gap: 8px;
            margin-top: 15px;
        }

        #ButtonSect button {
            font-size: 20px;
            border: none;
            border-radius: 8px;
            color: #f0f0f0;
            background: rgba(60, 60, 60, 0.8);
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }

        #ButtonSect button:hover {
            background: rgba(90, 90, 90, 0.85);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.45);
        }

        #ButtonSect button:active {
            transform: scale(0.95);
        }

        #HistoryPane {
            width: 250px;
            max-height: 500px;
            /* Set our max height and add overflow so it will then start to scroll past 500px*/
            overflow-y: auto;
            overflow-x: hidden;
            color: #e0e0e0;
        }

        #HistoryPane h3 {
            margin: 0 0 10px 0;
            text-align: center;
            font-size: 18px;
            color: #d0d0d0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            /*Add divider without needing ::before */
            padding-bottom: 6px;
        }

        .ihist {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            /*Add divider without needing ::before */
            padding: 6px 0;
            font-size: 15px;
        }

        .ehist {
            color: #aaaaaa;
            font-size: 14px;
        }

        .history-res {
            font-weight: bold;
            color: #ffffff;
        }
    </style>


</head>

<body>
    <div id="MainSect">
        <div id="SubDisplay"></div>
        <input id="DisplaySect" readonly>

        <div id="ButtonSect">
            <button>%</button>
            <button>CE</button>
            <button>C</button>
            <button>⌫</button>
            <button>1/x</button>
            <button>x²</button>
            <button>√x</button>
            <button>÷</button>
            <button>7</button>
            <button>8</button>
            <button>9</button>
            <button>×</button>
            <button>4</button>
            <button>5</button>
            <button>6</button>
            <button>−</button>
            <button>1</button>
            <button>2</button>
            <button>3</button>
            <button>+</button>
            <button class="zero">0</button>
            <button>+/-</button>
            <button>.</button>
            <button class="equal">=</button>
        </div>
    </div>

    <div id="HistoryPane">
        <h3>History</h3>
        <div id="HistoryList"></div>
    </div>

    <script>
        let display = document.getElementById("DisplaySect");
        let sub = document.getElementById("SubDisplay");
        let btns = document.querySelectorAll("#ButtonSect button"); // Grabs all our buttons as an array
        let history = document.getElementById("HistoryList");
        let curr = "";
        let last = "";
        let resflag = false; // Set a flag so we can clear our results so new numbers/ops arent added to the end

        function newhist(exp, res) {
            let div = document.createElement("div");
            div.classList.add("ihist");
            div.innerHTML = `<div class="ehist">${exp} =</div><div class="history-res">${res}</div>`;
            history.prepend(div); // Prepend adds our new history to the top of the list.
        }

        btns.forEach(btn => { // Iterate through our button array 
            btn.addEventListener("click", () => {
                console.log("Current: " + curr + ` Last: ` + last) // Debugging purposes
                let val = btn.innerText;

                if (!isNaN(val) || val === ".") {
                    if (resflag) {
                        display.value = "";
                        sub.innerText = "";
                        resflag = false;
                    }
                    display.value += val;
                }
                else if (val === "C") { // Clear our entire calculator. 
                    display.value = "";
                    sub.innerText = "";
                    curr = "";
                    resflag = false;
                }
                else if (val === "CE") {
                    display.value = ""; // Only clears our current expression and not our sub
                    resflag = false;
                }
                else if (val === "⌫") {
                    if (!resflag) {
                        display.value = display.value.slice(0, -1); // Removes the last character from our display string.
                        // resflag = false;
                    }
                }
                else if (val === "+/-") {
                    if (display.value.startsWith("-")) { // Our negative check (returns a boolean)
                        display.value = display.value.slice(1); // Remove the negative
                    } else {
                        display.value = "-" + display.value; // Add it
                    }
                    resflag = false;
                }
                else if (val === "=") {

                    try { // Use try for error handling so we can also display if theres a syntax error
                        let exp = curr + display.value;
                        exp = exp.replace(/×/g, "*").replace(/÷/g, "/").replace(/−/g, "-"); // Regex to replace our unusual operator symbols so we can solve with eval reliably
                        let res = eval(exp);
                        sub.innerText = exp + " =";
                        display.value = res;
                        newhist(exp, res);
                        curr = "";
                        last = res; // Handle the case that we would use our answer for the next calculation
                        resflag = true;
                    } catch {
                        display.value = "Syntax Error";
                        resflag = true;
                    }
                }
                // Using native math libs to do the work for us. 
                else if (val === "x²") {
                    display.value = Math.pow(parseFloat(display.value), 2);
                    resflag = true;
                }
                else if (val === "√x") {
                    display.value = Math.sqrt(parseFloat(display.value));
                    resflag = true;
                }
                else if (val === "1/x") {
                    display.value = 1 / parseFloat(display.value);  // Divide by one since we cant display fractions easily
                    resflag = true;
                }
                else {
                    curr += display.value + val;
                    sub.innerText = curr;
                    display.value = "";
                    resflag = false;
                }
            });
        });
    </script>
</body>

</html>